## 챕터 10 - 보안: 브라우저를 보호하는 HTTP의 기능

인터넷이 일반화되기 전에는 컴퓨터를 공격하여 파괴하는 것이 일반적이었으나, 인터넷과 브라우저의 도입과 동시에 다양한 공격 수단이 허용됐다.

### 10.1 기존의 공격

컴퓨터에 위협을 주는 소프트웨어를 맬웨어(malware)라 일컫는다. 맬웨어는 증식 방법이나 목적에 따라 다양하게 분류된다.

바이러스 > 프로그램을 감염시켜 복제 및 증가한다.
웜 > 네트워크 장비나 OS의 보안 취약점을 공격 및 감염시킨다.

키로거 > 키 입력을 기록한다.
트로이 목마 > 백도어를 만든다.

위 공격 기법들이 ‘기존’이라고 해서 현재 위협이 안되는 것은 아니다. 이를 기반 혹은 확장하여 웹 서비스를 공격해오고 있다.

### 10.2 브라우저를 노리는 공격의 특징

브라우저는 ‘열람용’ 앱이기에 OS 영역에서 뭔가를 하지는 않지만, 개인 정보 유출, 금전적 피해, 디도스 악용에 휘말리는 경우도 있다.

외에 HTML 및 자바스크립트의 취약성도 공격 대상이 된다. 최근 FE, SSO, OAuth, HTTPS 등 기술의 발전으로 개발자가 알아야 할 사양의 복잡성이 증가했다. 이로 인해 실수나 착각으로 보안에 구멍이 생기기도 한다. 그렇기에 통신 로그 기록을 통해 액세스나 다운로드할 커텐츠를 확인하는 등 새로운 대책이 필요하다.

### 10.3 크로스 사이트 스크립팅

많은 공격의 기점이 되는 공격 방법이다. 삽입된 스크립트가 쿠키에 액세스하거나 로그인 폼을 해킹하는 등 위험이 많다.

서버 측 방어는 새니타이즈나 이스케이프가 있다. 커맨드 인젝션, SQL 인젝션도 방어할 수 있다.

### 10.3.1 유출 방지 쿠키의 설정

httpOnly 속성을 통해 스크립트에서 쿠키에 접근할 수 없도록 한다.

### 10.3.2 X-XSS-Protection 헤더

HTML 인라인에서 스크립트 태그가 있는 경우와 같은 이상 패턴을 감지한다. IE, Chrome, Safari 등에서 지원한다. 패턴 매칭 기반이기에 거짓 양성 등의 문제가 있다.

### 10.3.3 Content-Security-Policy 헤더

웹사이트에서 사용하는 기능을 세밀하게 설정할 수 있는 헤더이다. 스크립트의 예상 범위를 벗어나는 동작을 억제한다. 크롬 앱은 필수이다.

설정을 너무 엄격하게 하면 동작을 방해할 수 있기 때문에 Content-Security-Policy-Report-Only 헤더로 검사는 하지만 동작은 멈추지 않게 설정할 수 있다.

### 10.3.4 Content-Security-Policy와 자바스크립트 템플릿 엔진 🛑

Hogan.js(Mustache 고속 버전)은 템플릿 컴파일을 통해 HTML을 컴파일한다..인듯? 스크립트 컴파일하는 건 프리 컴파일로 부르는 것 같다.

vue.js에도 이와 비슷한 사례가 있다.
독립실행형 > template 옵션에 문자열로 HTML 템플릿을 작성할 수 있다. 이 템플릿을 실행하면 스크립트로 변환되고 render()가 만들어진다.
런타임형 > 사전에 스크립트 코드를 브라우저 환경용에 최적화하고 render()를 만들어야 한다..?

[전체적으로 배경 지식이 없어 이해가 힘든 문단이다.]

### 10.3.5 Mixed Content

최근 웹에는 대부분 HTTPS가 적용되었으나, 광고나 외부 서비스 컨텐츠로 인해 HTTP가 섞이는 경우도 있다. 이를 수정하는 방법 외에 CSP의 upgrade-insecure-requests를 이용하는 방법이 있다. 이를 사용하면 https로 얻으러 간다.

### 10.3.6 교차 출처 리소스 공유

교차 출처 리소스 공유, CORS라고 불리는 정책은 API 서버를 보호하기 위한 개념이다.

크게 `simple cross-origin request`와 `actual request`로 나눌 수 있다.

simple cross-origin request 조건은 다음과 같다.

1. HTTP 요청 메서드가 GET, POST, HEAD 중 하나이다.
2. 헤더가 심플 헤더(Accept, Accept-Language, Content-Language, Content-Type)이다.
3. Content-Type을 포함하는 경우, 그 값이 application/x-www-form-urlencoded, multipart/form-data, text-plain 중 하나이다.

위 조건 중 하나라도 맞지 않다면 프리플라이트 요청이 필수이다. 다음 헤더를 붙여 OPTIONS 메서드로 전송한다.

1. Access-Control-Requet-Method 요청 헤더 (통신을 허용하길 원하는 메서드 지정)
2. Access-Control-Request-Headers 요청 헤더 (허용하기 원하는 헤더들)
3. Origin 응답 헤더 (통신 출처 웹 페이지의 도메인 이름)

응답은 다음과 같은 헤더로 온다.

1. Access-Control-Allow-Origin
2. Access-Control-Allow-Method
3. Access-Control-Allow-Headers
4. Access-Control-Allow-Credentials
5. Access-Control-Expose-Headers

### 10.4 중간자 공격

중간자 공격은 프록시 서버가 네트워크를 중계할 때 누설되는 정보를 탈취하는 문제이다. HTTPS로 방어할 수 있다.

### 10.4.1 HSTS

HSTS는 서버가 HTTPS 접속을 브라우저에게 강제하도록 알려주는 스펙이다.

첫 접속에는 HTTP이기에 문제가 있었으나 새로운 방화벽이 추가되며 해결됐다.

브라우저는 웹사이트에 신청해두고 최신 브라우저를 다운로드하면 HTTPS로 처음부터 접속하게 된다.

### 10.4.2 HTTP 공개 키 피닝 🛑

인증서 확인을 위한 공개 키를 로컬에 저장하고 이 후 전송받은 공개 키를 비교하는 스펙이다.

### 10.5 세션 하이재킹

세션 하이재킹은 세션 토큰을 훔쳐 웹사이트에 로그인하는 공격이다.

### 10.5.1 오래된 세션 관리와 세션 고정 공격 🛑

옛날에는 단말 ID를 식별값으로 사용했다..

### 10.5.2 쿠키 인젝션

.

### 10.6 사이트간 요청 위조

이미지 url 등을 통해 의도하지 않은 요청을 피해자가 보내게 하는 공격이다.

### 10.6.1 CSRF 대책 토큰

POST 요청 받은 곳에서 form hidden의 토큰 비교를 할 수 있다. CSRF 대책을 위한 토큰을 따로 관리하는 것도 방법이다.

### 10.6.2 SameSite 특성

같은 사이트끼리만 쿠키를 보내는 속성이다.

### 10.7 클릭재킹

정상 페이지에 투명이나 추가 페이지를 iframe태그로 넣어 공격하는 기법이다.

### 10.7.1 X-Frame-Options 헤더

X-Frame-Options 헤더를 통해 iframe 사용을 조정할 수 있다.

### 10.8 리스트형 계정 해킹

보안이 취약한 웹 사이트를 해킹해 인증 정보를 탈취해 다른 사이트에서 사용하는 공격이다.

2단계 인증, 물리 장치, 지오로케이션 등의 방법이 있으나, 사용자가 조심하는 것이 가장 좋다.

### 10.9 웹 애플리케이션을 위한 보안 가이드라인

### 10.10 웹 광고 및 보안

### 10.10.1 서드파티 쿠키