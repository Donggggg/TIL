## 챕터7 - 신뢰할 수 없는 코드를 쓰면서 불변성 지키기

### 7-1. 방어적 복사 (Defensive Copy)

내부 로직을 파악하고 있는 ‘우리’의 코드는 쉽게 불변성을 지킬 수 있지만 레거시 코드나 외부 라이브러리와 의존하게 되는 경우 불변성을 지키기 어렵게 된다. 불변성을 완전히 지키기 위한 하나의 방법으로 `방어적 복사` 라는 방식을 제안한다.

데이터의 출입이 발생할 때마다 데이터의 **깊은 복사본을 전달하는 방식**이 방어적 복사의 핵심 개념이다. 카피-온-라이트와 다르게 깊은 복사를 수행한다. 깊은 복사는 얕은 복사와 다르게 참조된 메모리도 전부 복사한다. 얕은 복사에 비해 비용이 높지만, 외부와 완벽한 격리를 위해 상황에 따라 필히 요구된다.

> **웹 API속에 방어적 복사**
>
> 클라이언트-서버 구조에서 데이터 전달(JSON, XML)은 방어적 복사를 거친다.
> 위와 같은 모듈 간의 통신을 위해 방어적 복사를 구현했다면 `비공유 아키텍처`라고 부른다.
>

> **Javascript에서의 깊은 복사**
>
> 직접 구현하거나 lodash를 사용하는 방법이 있었으나, 최근 스펙에 `structuredClone` 함수가 제공되며 쉽게 사용할 수 있게 되었다.
>