## 챕터 15 - 타임라인 격리하기

### 15-1. 장바구니 버그와 타임라인

장바구니의 아이템을 빠르게 두 번 이상 담으면 배송비가 중복 계산되는 버그가 있다. 이 버그를 추적 및 분석하기 위해 타임라인 다이어그램이라는 개념을 도입해본다.

타임라인 다이어그램은 직렬 및 병렬 실행 규칙이 기본적으로 있다. 또, 액션만 그리게 된다.

add_item_to_cart 함수에서도 액션을 확인하고 위 규칙에 의거하여 타임라인을 작성할 수 있다. 해당 함수에는 ajax 비동기 요청이 있다. 비동기 요청은 점섬으로 옆으로 작성하고 그 외 로직은 직렬로 작성한다. 이 직렬 타임라인은 별도 처리를 하지 않으면 중간에 다른 액션이 끼어들 수 있다.

좋은 타임라인을 만들기 위해서는 개수는 적게, 길이는 짧은 타임라임을 구성해야 하고, 공유하는 자원을 최대한 적게 두고 공유를 한다면 조율을 잘해야 한다.

### 15-2. 자바스크립트 이벤트 루프

싱글 스레드! 이벤트 루프! 너무나 잘 아는 이야기~

### 15-3. 다시 타임라인 만들기

자바스크립트의 동작방식을 알았으니 이제 직렬 액션은 하나로 묶을 수 있다. 비동기 콜백이 2개 이어진 구조였던 add_item_to_cart의 직렬 액션을 통합하고 타임라인도 통합한다. 이 상태로 두 번의 클릭을 가정하고 타임라인을 나열해보면 문제가 보인다. 콜백 액션의 순서가 엉키며 잘못된 값을 생산하게 된다.

이를 해결하기 위해 공유하는 자원을 제거한다. 전역변수를 지역변수로 바꾸고, 전역 변수를 명시적 인자로 변경한다. 이를 통해 액션을 계산으로 바꿀 수 있고, 타임라인이 짧아진다.