## 챕터 8,9 - 계층형 설계

### 1. 계층형 설계란?

저자는 소프트웨어 설계는 코드를 만들고, 테스트하고, 유지보수하기 **쉬운** 프로그래밍 방법을 선택하기 위해 미적 **감각**을 활용하는 것이라고 주장한다. 이 책은 그 감각을 기를 수 있는 하나의 훈련이다.

여기서 제시한 계층형 설계는 소프트웨어를 계층으로 구성하는 설계 방법이다. 각 계층에 있는 함수는 하위 계층 함수를 이용해 정의하게 된다. 앞선 예제로 계층을 나눠보자면 비즈니스 규칙/장바구니 동작/카피온라이트/언어 내장 함수로 나눌 수 있다. 아직까지 계층형 설계를 정확히 이해하기는 어렵지만 다음 장을 넘어가며 구체적인 내용을 살펴본다.

계층형 설계의 중요한 네 가지 패턴을 알아본다. 제목과 해당 장의 설명으로는 너무 추상적이어서 내용을 직접 다룰 때 더 설명하는 것이 좋을 것 같다.

1. 직접 구현
2. 추상화 벽
3. 작은 인터페이스
4. 편리한 계층

### 2. 직접 구현

직접 구현은 함수 시그니처가 나타내는 것을 적절한 구체화 수준에서 해결해야 한다는 법칙이다.

책의 예시로 `freeTieClip()`는 넥타이를 사면 무료 클립을 제공하는 역할을 하는 함수이다. 물론 역할은 충실히 하고 있으나 해당 함수는 너무나 구체화되어 있다. (알 필요 없는 정보까지 안다는 것이다.) 이를 해결하기 위해 장바구니에 제품이 있는지 확인하는 함수`isInCart()`를 만든다.

다음으로 isInCart()를 사용하기 전과 후의 호출 다이어그램을 작성한다. `p.175` 계층형 설계의 핵심인 함수는 하위 계층의 함수로만 정의된다.가 잘 지켜졌는지 확인해본다. 당연히도 전 코드는 여러 계층을 호출하고 후에는 한 계층만 호출한다.

### 3. 추상화 벽

추상화 벽은 어떤 계층은 세부 구현을 감추고 인터페이스를 제공한다는 법칙이다.

추상화 벽을 잘 적용한다면 구현을 몰라도(블랙 박스) 함수를 사용할 수 있다. 우리가 흔히 사용하는 라이브러이나 API가 비슷한 예시이다. 또, 사용부가 변경이 되어도 사용하는 입장에서는 변경이 필요없다.

이를 증명하기 위해 책에서는 기존 장바구니 구조인 배열을 맵으로 변경한다. 이 과정에서 상위는 변경할 일이 없고 하위만 변경하게 된다.

### 4. 작은 인터페이스

작은 인터페이스는 인터페이스를 최소한으로 만들자는 법칙이다.

새로운 코드를 추가해야 할 때, 최소한의 함수가 만들어지는 계층에 추가해야 한다. 이것을 위해 고려할 점은 꽤나 많다. 추상화 벽인지, 추가해야할 코드의 분류에 따른 위치라던지.. 이런 것들은 경험에서 확실히 우러나올 것 같다는 생각이다.

책에서는 시계 할인 및 로그 적재를 예시로 들었다.

### 5. 편리한 계층

편리한 계층은.. 케바케 사바사라는.. 법칙이다.

앞서 배운 세 가지 법칙도 좋다. 하지만 이 세 가지 법칙에 너무 몰두하여 쓸데 없는 계층을 만들어 나가지 말고 지금이 편리하다면 설계는 잠시 멈춰두자는 것이다. 그러다가 조금 지저분해진다면 다시 법칙을 적용해보자 라고 말한다.

### 6. 그래프와 비기능적 요구사항

개인적인 생각으로 그래프는 프로그래밍 세계에서 최고의 표현방법인 것 같다. 그래프를 통해 설계, 흐름, 관계 등 프로그래밍에서 필요한 모든 종류의 생각을 표현할 수 있고, 효율적이라고 생각한다.

그래프는 대표적인 비기능적 요구사항인 유지보수성, 테스트성, 재사용성을 파악하는 데도 도움을 준다. 하.. 그래프 감동적이다.